/**
 * Dashboard Module Styles
 * v1.0 - 10/16/25 - Initial implementation for Phase 2
 *
 * Architecture:
 * - BEM naming convention
 * - Fire TV compatible (no webkit-mask, viewport units with transforms, complex filters)
 * - Zero !important declarations
 * - CSS variables for dynamic values
 * - Simple transitions only (opacity, border-color, width)
 *
 * Blocks:
 * - .dashboard - Main container
 * - .dashboard-sidebar - Left sidebar
 * - .dashboard-menu - Menu within sidebar
 * - .dashboard-grid - 2×3 widget grid
 */

/* =============================================================================
   DASHBOARD CONTAINER
   ============================================================================= */

.dashboard {
  display: flex;
  flex-direction: column; /* Stack nav bars and content vertically */
  height: 100vh;
  width: 100vw;
  background-color: var(--grid-gap-color);
  color: var(--text-primary);
  overflow: hidden;
}

.dashboard--hidden {
  display: none;
}

/* Content wrapper - holds sidebar and grid horizontally */
.dashboard-content-wrapper {
  display: flex;
  flex-direction: row;
  flex: 1; /* Takes remaining space after nav bars */
  min-height: 0; /* Allow shrinking */
  overflow: hidden;
}

.dashboard--widget-focused {
  /* State when a widget is focused (centered/overlay) */
}

/* =============================================================================
   SIDEBAR
   ============================================================================= */

/* Sidebar wrapper - maintains space for collapsed sidebar in flex layout */
.dashboard-sidebar-wrapper {
  width: 60px;
  height: 100%; /* Fill content wrapper height, not viewport */
  position: relative;
  flex-shrink: 0;
  z-index: 10; /* Sidebar's stacking context - below selected cells (100) and overlay (150) */
}

/* Sidebar - overlays grid when expanded */
.dashboard-sidebar {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  width: 60px;
  height: 100%; /* Fill wrapper height, not viewport */
  background-color: var(--bg-primary);
  border-right: 1px solid var(--bg-tertiary);
  transition: width 0.3s ease, background 0.3s ease;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  /* z-index managed by wrapper */
}

.dashboard-sidebar--expanded {
  width: 200px;
  /* Semi-transparent gradient on right side when expanded (legacy style) */
  background: linear-gradient(
    to right,
    var(--bg-primary) 0%,
    var(--bg-primary) 40%,
    var(--bg-primary-semi-transparent) 100%
  );
  /* z-index managed by wrapper */
}

/* =============================================================================
   LOGO
   ============================================================================= */

.dashie-logo {
  width: 100px;
  height: auto;
  margin: 8px auto 20px auto;
  opacity: 0;
  object-fit: contain;
  transition: opacity var(--transition-normal);
  display: block;
}

.dashboard-sidebar--expanded .dashie-logo {
  opacity: 1;
}

/* =============================================================================
   MENU
   ============================================================================= */

.dashboard-menu {
  display: flex;
  flex-direction: column;
  padding: 0;
  margin-top: auto; /* Push menu to bottom of sidebar */
  padding-bottom: 20px;
}

.dashboard-menu__item {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding: 4px 8px;
  background: transparent;
  border: none;
  border-left: 6px solid transparent; /* Thick left border for selection indicator */
  border-radius: 0;
  margin: 0;
  cursor: pointer;
  transition: border-color 0.2s ease, background-color 0.2s ease;
  color: var(--text-primary);
  font-size: 14px;
  font-family: inherit;
  text-align: left;
  white-space: nowrap;
  height: 28px;
  line-height: 1.2;
}

.dashboard-menu__item--selected {
  border-left-color: var(--accent-blue); /* Thick left border only */
  background-color: var(--bg-selected-fill);
  font-weight: 600;
}

.dashboard-menu__icon {
  width: 20px;
  height: 20px;
  object-fit: contain;
  flex-shrink: 0;
  /* Icon color controlled by theme variable */
  filter: var(--sidebar-icon-filter);
  transition: transform 0.2s ease, filter 0.3s ease, margin-left 0.3s ease;
  /* When collapsed, shift icon left to compensate for border and center it */
  /* Sidebar collapsed width: 60px, icon: 20px, should be at 20px from left */
  /* Currently at: 6px (border) + 8px (padding) = 14px */
  /* Need to shift right by 6px to center: (60-20)/2 = 20px target */
  margin-left: 6px;
}

/* When expanded, remove the margin offset */
.dashboard-sidebar--expanded .dashboard-menu__icon {
  margin-left: 0;
}

.dashboard-menu__label {
  font-size: 14px;
  margin-left: 12px;
  opacity: 0;
  white-space: nowrap;
  transition: opacity 0.3s ease;
}

.dashboard-sidebar--expanded .dashboard-menu__label {
  opacity: 1;
}

/* =============================================================================
   GRID
   ============================================================================= */

.dashboard-grid {
  flex: 1;
  display: grid;
  /* Grid template will be set dynamically by JavaScript per-page */
  /* Fallback: 3 rows × 2 columns, equal sizing (if JS doesn't set) */
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: var(--grid-gap);
  padding: var(--grid-gap);
  height: 100%; /* Fill content wrapper, not viewport */
  max-height: 100%;
  overflow: visible; /* Allow cells to overflow and appear above sidebar */
  box-sizing: border-box;
  /* NO position/z-index - prevents creating stacking context that would trap focused widgets */
  /* This matches legacy #grid behavior and allows focused widgets to render at proper z-index */
}

.dashboard-grid__cell {
  background-color: var(--bg-secondary);
  border: none; /* No border - focus states use box-shadow instead */
  border-radius: var(--border-radius);
  padding: 16px;
  transition: box-shadow 0.2s ease, transform 0.2s ease, z-index 0s;
  overflow: hidden;
  position: relative;
  z-index: 1; /* Base z-index for cells */
  /* Ensure cells don't overflow their grid area */
  min-height: 0;
  min-width: 0;
}

/* Support for cells that span multiple rows/columns */
/* NOTE: Spans are now applied via inline styles in dom-builder.js */
/* These classes are kept for backward compatibility but are no longer used */
.dashboard-grid__cell--rowspan-2 {
  grid-row: span 2;
}

.dashboard-grid__cell--colspan-2 {
  grid-column: span 2;
}

/* =============================================================================
   ENHANCED FOCUS MODE - SELECTED STATE (Grid Navigation)
   ============================================================================= */

.dashboard-grid__cell--focused {
  /* State 1: Selected (navigating grid with arrow keys) */
  border-radius: var(--border-radius);
  box-shadow: var(--glow-selected),
              inset 0 0 0 var(--border-width-selected) var(--color-selected-silver);
  transform: scale(1.05); /* 105% scale for enhanced mode */
  transition: all var(--transition-fast);
  z-index: var(--z-widget-selected); /* 100 - Above sidebar (10) but below overlay (150) */
  overflow: visible; /* Allow border to be fully visible when focused */
}

/* =============================================================================
   ENHANCED FOCUS MODE - FOCUSED STATE (Widget Centered with Overlay)
   ============================================================================= */

.dashboard-grid__cell--widget-focused {
  /* State 2: Focused (ENTER pressed, widget centered, overlay visible) */
  /* Don't use position: fixed - keep in normal flow and translate from current position */
  position: relative;
  z-index: calc(var(--z-widget-focused) + 1) !important; /* 201 - Above overlay (150), matches legacy .centered class */

  /* Silver border and glow */
  border-radius: var(--border-radius);
  box-shadow: var(--glow-selected),
              inset 0 0 0 var(--border-width-selected) var(--color-selected-silver);

  /* Transform will be set via inline style with calculated translate values */
  /* Example: transform: translate(100px, 50px) scale(1.05) */

  /* Ensure smooth transition */
  transition: transform 0.4s cubic-bezier(0.4, 0.0, 0.2, 1),
              box-shadow var(--transition-fast),
              border-radius var(--transition-fast);
}

/* =============================================================================
   ENHANCED FOCUS MODE - ACTIVE STATE (Controlling Widget)
   ============================================================================= */

.dashboard-grid__cell--widget-active {
  /* State 3: Active (RIGHT pressed from focused, controlling widget, menu dimmed) */
  position: relative;
  z-index: calc(var(--z-widget-focused) + 1) !important; /* 201 - Above overlay (150), matches legacy */

  /* Blue border and glow */
  border-radius: var(--border-radius);
  box-shadow: var(--glow-focused),
              inset 0 0 0 var(--border-width-active) var(--color-active-blue);

  /* Transform includes 108% scale (set via inline style) */
  /* Example: transform: translate(100px, 50px) scale(1.08) */

  /* Smooth transition to blue border */
  transition: transform 0.3s ease,
              box-shadow 0.3s ease,
              border-radius var(--transition-fast);
}

.dashboard-grid__placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  font-size: 18px;
  color: var(--text-muted);
  text-align: center;
}

/* =============================================================================
   FOCUS OVERLAY
   ============================================================================= */

/* Darken background when widget is focused (50% opacity for enhanced mode) */
/* Use separate div element like legacy code - not pseudo-element */
.focus-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: var(--z-focus-overlay); /* 150 - Below focused widget (200) but above everything else */
  pointer-events: none;
  opacity: 0;
  transition: opacity var(--transition-medium);
}

.focus-overlay.visible {
  opacity: 1;
  pointer-events: auto; /* Clickable when visible - allows defocus when clicking overlay */
  cursor: pointer;
}

/* Prevent clicks on unfocused widgets when overlay is visible */
.dashboard--widget-focused .dashboard-grid__cell:not(.dashboard-grid__cell--widget-focused):not(.dashboard-grid__cell--widget-active) {
  pointer-events: none;
}

/* Prevent clicks on sidebar when overlay is visible */
.dashboard--widget-focused .dashboard-sidebar {
  pointer-events: none;
}

/* =============================================================================
   RESPONSIVE ADJUSTMENTS
   ============================================================================= */

/* Mobile/Tablet - Stack vertically */
/* DISABLED: This breakpoint was causing layout issues when console is open
   TODO: Re-enable when we have proper mobile/tablet support
@media (max-width: 768px) {
  .dashboard {
    flex-direction: column;
  }

  .dashboard-sidebar {
    width: 100%;
    height: 60px;
  }

  .dashboard-sidebar--expanded {
    height: auto;
  }

  .dashboard-menu {
    flex-direction: row;
    overflow-x: auto;
  }

  .dashboard-grid {
    grid-template-columns: 1fr;
    grid-template-rows: repeat(6, 1fr);
  }
}
*/

/* =============================================================================
   CSS VARIABLES - Enhanced Focus Mode
   ============================================================================= */

/* Dashboard uses legacy theme variables directly from css/core/variables.css
   Theme-specific colors (bg-primary, text-primary, etc.) automatically update
   when body.theme-dark or body.theme-light class is applied */

:root {
  /* Enhanced Focus Mode Colors - use legacy theme colors */
  --color-selected-silver: var(--accent-silver);
  --color-active-blue: var(--accent-blue);

  /* Border widths for enhanced focus mode */
  --border-width-selected: 6px;
  --border-width-active: 6px;
}

/* =============================================================================
   ACCESSIBILITY
   ============================================================================= */

/* Ensure focus is visible for keyboard navigation */
.dashboard-menu__item:focus,
.dashboard-grid__cell:focus {
  outline: 2px solid var(--accent-blue);
  outline-offset: 2px;
}

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  .dashboard-sidebar,
  .dashboard-menu__item,
  .dashboard-grid__cell,
  .dashboard-menu__label {
    transition: none;
  }
}

/* =============================================================================
   WIDGET IFRAMES (Phase 3.5)
   ============================================================================= */

/* Widget iframe container */
.widget-iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: var(--border-radius);
  background: transparent;
  display: block;
  overflow: hidden;
}

/* Remove default iframe scrollbars */
.widget-iframe::-webkit-scrollbar {
  display: none;
}

/* Ensure iframe content fills container while respecting cell borders */
.dashboard-grid__cell iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
  /* Add pointer-events to allow iframe interaction */
  pointer-events: auto;
}

/* When cell is focused, ensure iframe doesn't cover the inset border */
.dashboard-grid__cell--focused iframe,
.dashboard-grid__cell--widget-focused iframe,
.dashboard-grid__cell--widget-active iframe {
  /* Inset the iframe to make room for the border */
  top: var(--border-width-selected);
  left: var(--border-width-selected);
  width: calc(100% - calc(var(--border-width-selected) * 2));
  height: calc(100% - calc(var(--border-width-selected) * 2));
}

/* =============================================================================
   PAGE NAVIGATION ARROWS (Touch Controls)
   ============================================================================= */

.page-nav-arrows {
  /* Container not needed - arrows insert directly into dashboard flow */
  display: contents; /* Pass-through container */
}

.page-nav-arrow {
  width: 100%;
  height: 40px;
  border: none;
  background: var(--accent-current-time, #00aaff);
  opacity: 0.3;
  color: var(--text-primary, #1a1a1a);
  font-size: 24px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: opacity 0.2s ease;
  user-select: none;
  padding: 0;
  margin: 0;
  position: relative; /* Flow positioning, not fixed */
  flex-shrink: 0; /* Don't compress the nav bar */
  z-index: 1; /* Behind sidebar (10) and behind sidebar wrapper (10) */
}

.page-nav-arrow:hover {
  opacity: 0.5;
}

.page-nav-arrow:active {
  opacity: 0.6;
}

/* Position chevron centered between sidebar (60px) and right edge */
.page-nav-arrow::before {
  content: attr(data-chevron); /* Will be set by JS */
  margin-left: 30px; /* Half of sidebar width (60px / 2) to center in remaining space */
}

/* Position based on direction - controls order in flex column */
.page-nav-arrow--up {
  order: -1; /* Appears before content wrapper */
}

.page-nav-arrow--down {
  order: 1; /* Appears after content wrapper */
}
